#:import dp kivy.metrics.dp
#:import MDIconButton kivymd.uix.button.MDIconButton

<IngredientRow>:
    size_hint_y: None
    height: dp(56)
    text_size: self.width - dp(16), None
    halign: "left"
    valign: "middle"
    padding_x: dp(8)
    color: 0.95, 0.98, 1, 1
    canvas.before:
        Color:
            rgba: (0.2, 0.25, 0.36, 1) if self.state == "down" else (0.13, 0.16, 0.24, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10, ]

<HeaderBar>:
    size_hint_y: None
    height: dp(82)
    spacing: dp(12)
    padding: dp(12), dp(10)
    size_hint_x: None
    width: min(root.width if root.width else dp(420), root.height if root.height else dp(420)) * 0.76
    pos_hint: {"center_x": 0.5}
    canvas.before:
        Color:
            rgba: 0.1, 0.11, 0.16, 0.95
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [self.height / 2,]
    MDIconButton:
        icon: "home"
        disabled: root.home_disabled
        size_hint: None, None
        size: dp(56), dp(56)
        theme_icon_color: "Custom"
        icon_size: "30sp"
        icon_color: (0.9, 0.95, 1, 1) if not self.disabled else (0.45, 0.45, 0.45, 1)
        md_bg_color: (0.22, 0.52, 0.95, 1) if not self.disabled else (0.2, 0.2, 0.2, 1)
        rounded_button: True
        on_release: root.go_home()
    Label:
        text: "CocktailBot"
        font_size: '26sp'
        bold: True
        color: 0.95, 0.97, 1, 1
    MDIconButton:
        icon: "cog"
        disabled: root.settings_disabled
        size_hint: None, None
        size: dp(56), dp(56)
        theme_icon_color: "Custom"
        icon_size: "30sp"
        icon_color: (0.95, 0.9, 1, 1) if not self.disabled else (0.45, 0.45, 0.45, 1)
        md_bg_color: (0.36, 0.3, 0.8, 1) if not self.disabled else (0.2, 0.2, 0.2, 1)
        rounded_button: True
        on_release: root.go_settings()


<CocktailCard>:
    orientation: 'vertical'
    padding: dp(0)
    spacing: dp(12)
    canvas.before:
        Color:
            rgba: 0, 0, 0, 0
        Rectangle:
            pos: self.pos
            size: self.size
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'center'
        size_hint_y: 0.86
        Widget:
            size_hint: None, None
            size: min(root.width, root.height) * 0.68, min(root.width, root.height) * 0.68
            canvas.before:
                Color:
                    rgba: (0.95, 0.47, 0.16, 1) if root.available else (0.5, 0.3, 0.25, 1)
                Line:
                    circle: self.center_x, self.center_y, self.width * 0.495
                    width: dp(14)
                Color:
                    rgba: 0.05, 0.05, 0.08, 1
                Ellipse:
                    pos: self.x + self.width * 0.11, self.y + self.height * 0.11
                    size: self.width * 0.78, self.height * 0.78
            AsyncImage:
                source: root.image_path if root.image_path else 'atlas://data/images/defaulttheme/button'
                allow_stretch: True
                keep_ratio: True
                size_hint: None, None
                size: self.parent.width * 0.74, self.parent.height * 0.74
                center: self.parent.center
                color: (1, 1, 1, 1) if root.available else (0.45, 0.45, 0.45, 1)
    Label:
        text: ("Available" if root.available else "Unavailable")
        size_hint_y: None
        height: dp(52)
        font_size: '30sp'
        bold: True
        color: (0.38, 0.95, 0.54, 1) if root.available else (1, 0.48, 0.42, 1)


<HomeScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.02, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.93, 0.45, 0.14, 1
            Line:
                circle: self.center_x, self.center_y, min(self.width, self.height) * 0.46
                width: min(dp(34), min(self.width, self.height) * 0.06)
            Color:
                rgba: 0.05, 0.06, 0.09, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.43, self.center_y - min(self.width, self.height) * 0.43)
                size: (min(self.width, self.height) * 0.86, min(self.width, self.height) * 0.86)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(8)
            padding: dp(16), dp(10)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
            Label:
                text: root.selected_recipe_name
                size_hint_y: None
                height: dp(88)
                font_size: '54sp'
                bold: True
                color: 0.95, 0.98, 1, 1
                halign: 'center'
                valign: 'middle'
                text_size: self.width, self.height
            Carousel:
                id: cocktail_carousel
                loop: False
                on_index: root.on_carousel_index(self.index)
            Button:
                text: "Prepare Cocktail"
                size_hint_y: None
                height: dp(90)
                font_size: '32sp'
                bold: True
                disabled: not root.selected_available
                background_normal: ''
                background_down: ''
                background_color: (0, 0, 0, 0)
                color: 0.95, 1, 0.95, 1
                on_release: root.prepare_selected()
                canvas.before:
                    Color:
                        rgba: (0.16, 0.74, 0.41, 1) if not self.disabled else (0.36, 0.36, 0.36, 1)
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(32), ]

<SettingsScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.08, 0.11, 0.2, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(12)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
            ScrollView:
                do_scroll_x: False
                BoxLayout:
                    id: pump_list
                    orientation: 'vertical'
                    size_hint_y: None
                    spacing: dp(10)
                    padding: dp(8)
                    height: self.minimum_height

<CalibrationScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.08, 0.11, 0.2, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(12)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
            ScrollView:
                do_scroll_x: False
                BoxLayout:
                    id: calibration_list
                    orientation: 'vertical'
                    size_hint_y: None
                    spacing: dp(10)
                    padding: dp(8)
                    height: self.minimum_height

<PouringScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.08, 0.11, 0.2, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(20)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
                home_disabled: True
                settings_disabled: True
            Label:
                text: "üß™ " + root.status_text
                font_size: '42sp'
                color: 0.95, 0.98, 1, 1
            Label:
                text: root.progress_text
                font_size: '30sp'
                color: 0.74, 0.82, 1, 1
            Button:
                text: "‚èπ STOP"
                size_hint_y: None
                height: dp(120)
                background_normal: ''
                background_down: ''
                background_color: 0.92, 0.2, 0.28, 1
                font_size: '38sp'
                bold: True
                on_release: root.confirm_stop()

<DoneScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.08, 0.11, 0.2, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(18)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
            Label:
                text: "‚úÖ"
                font_size: '128sp'
            Label:
                text: "Cocktail done"
                font_size: '48sp'
                bold: True
                color: 0.95, 0.98, 1, 1
            Button:
                text: "‚Ü∫ Go Home"
                size_hint_y: None
                height: dp(96)
                font_size: '34sp'
                bold: True
                background_normal: ''
                background_down: ''
                background_color: 0.22, 0.52, 0.95, 1
                on_release: app.go_home()
