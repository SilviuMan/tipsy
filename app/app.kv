#:import dp kivy.metrics.dp
#:import MDIconButton kivymd.uix.button.MDIconButton

<HeaderBar>:
    size_hint_y: None
    height: dp(92)
    spacing: dp(10)
    padding: dp(10), dp(10)
    canvas.before:
        Color:
            rgba: 0.08, 0.09, 0.14, 0.97
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [24,]
    MDIconButton:
        icon: "home"
        disabled: root.home_disabled
        theme_icon_color: "Custom"
        icon_color: (0.75, 0.83, 1, 1) if not self.disabled else (0.4, 0.4, 0.4, 1)
        md_bg_color: (0.22, 0.52, 0.95, 1) if not self.disabled else (0.2, 0.2, 0.2, 1)
        on_release: root.go_home()
    Label:
        text: "CocktailBot"
        font_size: '34sp'
        bold: True
        color: 0.95, 0.97, 1, 1
    MDIconButton:
        icon: "cog"
        disabled: root.settings_disabled
        theme_icon_color: "Custom"
        icon_color: (0.9, 0.85, 1, 1) if not self.disabled else (0.4, 0.4, 0.4, 1)
        md_bg_color: (0.36, 0.3, 0.8, 1) if not self.disabled else (0.2, 0.2, 0.2, 1)
        on_release: root.go_settings()


<CocktailCard>:
    orientation: 'vertical'
    padding: dp(16)
    spacing: dp(10)
    canvas.before:
        Color:
            rgba: 0, 0, 0, 0
        Rectangle:
            pos: self.pos
            size: self.size
    Widget:
        size_hint_y: 0.05
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'center'
        size_hint_y: 0.72
        Widget:
            size_hint: None, None
            size: min(root.width, root.height) * 0.62, min(root.width, root.height) * 0.62
            canvas.before:
                Color:
                    rgba: (0.95, 0.47, 0.16, 1) if root.available else (0.5, 0.3, 0.25, 1)
                Line:
                    circle: self.center_x, self.center_y, self.width * 0.49
                    width: dp(16)
                Color:
                    rgba: (0.95, 0.95, 0.95, 1) if root.available else (0.55, 0.55, 0.55, 1)
                Line:
                    circle: self.center_x, self.center_y, self.width * 0.38
                    width: dp(8)
            AsyncImage:
                source: root.image_path if root.image_path else 'atlas://data/images/defaulttheme/button'
                allow_stretch: True
                keep_ratio: True
                size_hint: None, None
                size: self.parent.width * 0.62, self.parent.height * 0.62
                center: self.parent.center
                color: (1, 1, 1, 1) if root.available else (0.45, 0.45, 0.45, 1)
    Label:
        text: root.recipe_name
        size_hint_y: None
        height: dp(46)
        font_size: '34sp'
        bold: True
        color: 0.95, 0.98, 1, 1
    Label:
        text: ("‚úÖ Available" if root.available else "‚ö† Unavailable")
        size_hint_y: None
        height: dp(38)
        font_size: '24sp'
        color: (0.38, 0.95, 0.54, 1) if root.available else (1, 0.48, 0.42, 1)


<HomeScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.06, 0.07, 0.1, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(12)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
            Label:
                text: root.selected_recipe_name
                size_hint_y: None
                height: dp(76)
                font_size: '58sp'
                bold: True
                color: 0.95, 0.98, 1, 1
            Carousel:
                id: cocktail_carousel
                loop: False
                on_index: root.on_carousel_index(self.index)
            Button:
                text: "‚ñ∂  Prepare Cocktail"
                size_hint_y: None
                height: dp(96)
                font_size: '34sp'
                bold: True
                disabled: not root.selected_available
                background_normal: ''
                background_down: ''
                background_color: (0.18, 0.76, 0.46, 1) if not self.disabled else (0.25, 0.25, 0.25, 1)
                on_release: root.prepare_selected()

<SettingsScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.08, 0.11, 0.2, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(12)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
            ScrollView:
                do_scroll_x: False
                BoxLayout:
                    id: pump_list
                    orientation: 'vertical'
                    size_hint_y: None
                    spacing: dp(10)
                    padding: dp(8)
                    height: self.minimum_height

<CalibrationScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.08, 0.11, 0.2, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(12)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
            ScrollView:
                do_scroll_x: False
                BoxLayout:
                    id: calibration_list
                    orientation: 'vertical'
                    size_hint_y: None
                    spacing: dp(10)
                    padding: dp(8)
                    height: self.minimum_height

<PouringScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.08, 0.11, 0.2, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(20)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
                home_disabled: True
                settings_disabled: True
            Label:
                text: "üß™ " + root.status_text
                font_size: '42sp'
                color: 0.95, 0.98, 1, 1
            Label:
                text: root.progress_text
                font_size: '30sp'
                color: 0.74, 0.82, 1, 1
            Button:
                text: "‚èπ STOP"
                size_hint_y: None
                height: dp(120)
                background_normal: ''
                background_down: ''
                background_color: 0.92, 0.2, 0.28, 1
                font_size: '38sp'
                bold: True
                on_release: root.confirm_stop()

<DoneScreen>:
    BoxLayout:
        orientation: 'vertical'
        canvas.before:
            Color:
                rgba: 0.01, 0.01, 0.03, 1
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: 0.08, 0.11, 0.2, 1
            Ellipse:
                pos: (self.center_x - min(self.width, self.height) * 0.49, self.center_y - min(self.width, self.height) * 0.49)
                size: (min(self.width, self.height) * 0.98, min(self.width, self.height) * 0.98)
        BoxLayout:
            orientation: 'vertical'
            spacing: dp(18)
            size_hint: None, None
            width: min(root.width, root.height) * 0.84
            height: min(root.width, root.height) * 0.84
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            HeaderBar:
            Label:
                text: "‚úÖ"
                font_size: '128sp'
            Label:
                text: "Cocktail done"
                font_size: '48sp'
                bold: True
                color: 0.95, 0.98, 1, 1
            Button:
                text: "‚Ü∫ Go Home"
                size_hint_y: None
                height: dp(96)
                font_size: '34sp'
                bold: True
                background_normal: ''
                background_down: ''
                background_color: 0.22, 0.52, 0.95, 1
                on_release: app.go_home()
